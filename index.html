<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="NetworkPub">
    <meta name="author" content="Guillaume Calmettes">

    <title>networkPubs</title>

    <!-- Bootstrap core CSS -->
    <link href="src/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="src/css/custom.css" rel="stylesheet">

  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">networkPubs</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <br><br>

    <div class="container" align="center">
      <div> 
        <h1>Want to see a network?</h1><br>
        <p align="left">
          Science is all about collaborations. Type the name of an author (or a list of authors) and see with whom they have published! (separate authors by a semicolon if more than one author entered).
        </p>
      </div>
    </div>

    <br>
    
    <div class="container" align="center">
      <!-- Request the URL -->
      <form action="javascript:getData();">
        <div class="form-group col-md-6">
          <input type="text" id="authorList" name='authorList' placeholder="Enter the authors to look up here"><br>
        </div>
      
        <div>
          <button type="submit" class="button">Show me the network!</button>
        </div>
      </form>
    </div>
    <br>
    <div id="viz" width="100%"></div>


    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/viz.js"></script>
	
		<script type="text/javascript">
			function getData(){
				const authorList = document.querySelector("#authorList").value.split(";")
				if (authorList == [""]) {
					alert("Enter some authors name first!")
				} else {
					showMeTheGraphFor(authorList)
				}
			}
		</script>
    <style>

    .nodeLabel {
      fill: black;
    }

    .nodeCircle {
      stroke: black;
      stroke-width: 1.5px;
    }

    canvas {
    	position: absolute;
    	margin: 0;
    }

    svg {
    	position: absolute;
    	margin: 0;
    }

    </style>


    <!-- <script type="text/javascript">

    const targetAuthor = ["Morand, pauline"]
    // const targetAuthor = ['de Aguiar Vallim TQ', 'Tarling EJ', 'Calmettes G']
    // const targetAuthor = ["Weiss JN", "Calmettes G"]


    const width = 900,
        	height = 600;

    // canvas for drawing edges
    const canvas = d3.select("#viz").append("canvas")
    	.attr("width", width)
    	.attr("height", height);
    const context = canvas.node()
    	.getContext("2d");

    // svg for nodes so tracking is possible
    const svg = d3.select("#viz")
    	.append("svg")
    		.attr("width", width)
    		.attr("height", height)

    // force layout simulation
    const linkStrengthScale = d3.scaleLinear()
    	.range([0.05, 0.5]);
    const sizeStrengthScale = d3.scaleLinear()
    	.range([-5, -50]);


    const simulation = d3.forceSimulation()
    	.force("link", d3.forceLink().id(d => d.id).strength(d => linkStrengthScale(+d.size)))
    	.force("charge", d3.forceManyBody().strength(d => sizeStrengthScale(+d.size)))
    	.force("center", d3.forceCenter(width / 2, height / 2));


    // scales for nodes and links
    const nodeScale = d3.scaleLinear()
        .range([2, 20])

    const labelScale = d3.scaleLinear()
        .range([0.4, 1])

    const edgeScale = d3.scaleLinear()
        .range([0.01, 8])

    const opacityScale = d3.scaleLinear()
        .range([0.3, 1])

    const nodeColorScale = d3.scaleSequential(d3.interpolateCool)

    const edgeColorScale = d3.scaleSequential(d3.interpolatePuRd)



    let nodeLayer, nodeG, graph

    // get the data and draw graph
    // const authorGraph = getAuthorGraph(targetAuthor, width, height)
    // authorGraph.then(graphData => {

    // 	graph = graphData
    // 	updateScales(graph)

    //   nodeLayer = svg.append("g")
    //       .attr("class", "nodeLayer")
      
    //   updateScene(graph)

    //   simulation
    //     .nodes(graph.nodes)
    //     .on("tick", ticked);

    //   simulation.force("link")
    //     .links(graph.edges);

    //   console.log("Enjoy!")
    // });


    function updateScene(graph){

    	nodeG = nodeLayer.selectAll(".node")
        .data(graph.nodes)
        .enter()
        .append("g")
          .attr("class", "node")
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

      nodeG.append("circle")
        .attr("class", "nodeCircle")
        .attr("r", d => nodeScale(d.size))
        .attr("fill", d => nodeColorScale(d.size))
        
      nodeG.append("text")
        .attr("class", "nodeLabel")
          .text(d => d.id)
          .attr("dx", 0)
          .attr("dy", 15)
          .style("text-anchor", "middle")
          .style("font-size", d => `${labelScale(d.size)}em`);
    }

    function ticked() {
    	context.clearRect(0, 0, width, height);

    	// draw links
    	graph.edges.forEach(d => {

    	  // keep the nodes within the boundaries of the svg
    	  d.target.x = d.target.x < 0 ? 0 : d.target.x > width ? width : d.target.x
    	  d.target.y = d.target.y < 0 ? 0 : d.target.y > height ? height : d.target.y
    	  d.source.x = d.source.x < 0 ? 0 : d.source.x > width ? width : d.source.x
    	  d.source.y = d.source.y < 0 ? 0 : d.source.y > height ? height : d.source.y

    	  const dx = d.target.x - d.source.x,
    	        dy = d.target.y - d.source.y
    	  const dr = Math.sqrt(dx * dx + dy * dy);

    	  context.strokeStyle = edgeColorScale(d.size);

    	  context.beginPath();
    	  const p = new Path2D(`M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`);
    		context.lineWidth = edgeScale(d.size)
    		context.stroke(p);
    	});

    	nodeG
    	  .attr("transform", d => {
    	    // keep the node within the boundaries of the svg
    	    d.x = d.x < 0 ? 0 : d.x > width ? width : d.x
    	  	d.y = d.y < 0 ? 0 : d.y > height ? height : d.y
    	    return `translate(${d.x}, ${d.y})`
    	  })
    }

    function updateScales(graph){
    	// set scales domain from data
      nodeScale.domain(d3.extent(graph.nodes, d => d.size))
      nodeColorScale.domain(d3.extent(graph.nodes, d => d.size))
      labelScale.domain(d3.extent(graph.nodes, d => d.size))
      edgeColorScale.domain(d3.extent(graph.edges, d => d.size))
      edgeScale.domain(d3.extent(graph.edges, d => d.size))
      opacityScale.domain(d3.extent(graph.edges, d => d.size))

      // set forces domain from data
      linkStrengthScale
        .domain(d3.extent(graph.edges, d => d.size))
      sizeStrengthScale
        .domain(d3.extent(graph.nodes, d => d.size))
    }

    function dragstarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.8).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }


    </script> -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>    
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="src/js/bootstrap.min.js"></script>
  </body>
